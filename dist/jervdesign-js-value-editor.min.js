/*! jervdesign-js-value-editor 2016-07-12 */

angular.module("JervDesignJsValueEditor",[]);var JervDesignJsValueEditorConfig={schemaConfig:{"field.name":{type:"literal",title:"Field",required:!0,filterValidate:null}},types:{literal:"JervDesignJsValueEditorDataTypeLiteral",string:"JervDesignJsValueEditorDataTypeString",null:"JervDesignJsValueEditorDataTypeNull",number:"JervDesignJsValueEditorDataTypeNumber",object:"JervDesignJsValueEditorDataTypeObject",array:"JervDesignJsValueEditorDataTypeArray",boolean:"JervDesignJsValueEditorDataTypeBoolean"},"type-changer":{description:"Handles changing types",directive:"jervdesign-js-value-editor-type-changer"},distPath:"/vendor/jervdesign-js-value-editor/dist/"};angular.module("JervDesignJsValueEditor").run(["JervDesignJsValueEditorService","JervDesignJsValueEditorDataTypeString","JervDesignJsValueEditorDataTypeNull","JervDesignJsValueEditorDataTypeNumber","JervDesignJsValueEditorDataTypeObject","JervDesignJsValueEditorDataTypeArray","JervDesignJsValueEditorDataTypeBoolean",function(JervDesignJsValueEditorService,JervDesignJsValueEditorDataTypeString,JervDesignJsValueEditorDataTypeNull,JervDesignJsValueEditorDataTypeNumber,JervDesignJsValueEditorDataTypeObject,JervDesignJsValueEditorDataTypeArray,JervDesignJsValueEditorDataTypeBoolean){JervDesignJsValueEditorService.setTypeService(JervDesignJsValueEditorDataTypeString),JervDesignJsValueEditorService.setTypeService(JervDesignJsValueEditorDataTypeNull),JervDesignJsValueEditorService.setTypeService(JervDesignJsValueEditorDataTypeNumber),JervDesignJsValueEditorService.setTypeService(JervDesignJsValueEditorDataTypeObject),JervDesignJsValueEditorService.setTypeService(JervDesignJsValueEditorDataTypeArray),JervDesignJsValueEditorService.setTypeService(JervDesignJsValueEditorDataTypeBoolean)}]);var JervDesignJsValueEditorEvents=function(){var self=this,listeners={};self.on=function(event,listenerId,method){return listeners[event]||(listeners[event]={}),listeners[event][listenerId]=method,listenerId},self.trigger=function(event,args){if(listeners[event]){var listenerList=listeners[event];for(var key in listenerList)if(listenerList.hasOwnProperty(key)){var value=listenerList[key];"function"==typeof value&&value(args)}}}};angular.module("JervDesignJsValueEditor").service("JervDesignJsValueEditorEvents",function(){return new JervDesignJsValueEditorEvents});var JervDesignJsValueEditorDataSchema=function(){var self=this;self.type="null",self.originalType="null",self.name="",self.accessor="",self.value=null,self.originalValue=null,self.displayValue="",self.originalDisplayValue="",self.directive=null,self.filterValidate=function(){return new JervDesignJsValueEditorFilterValidateResult}};angular.module("JervDesignJsValueEditor").factory("JervDesignJsValueEditorDataSchema",[function(){return JervDesignJsValueEditorDataSchema}]);var JervDesignJsValueEditorFilterDataType=function(){var dataType=this;dataType.type="DEFAULT",dataType.description="DEFAULT",dataType.directive="",dataType.canCreateValue=!1,dataType.canUpdateValue=!1,dataType.canDeleteValue=!1,dataType.rebuildOnChange=!1,dataType.buildSchemaValues=function(name,value,accessor,schema){},dataType.createValue=function(key,subValue,schemaValue){},dataType.updateValue=function(key,subValue,schemaValue){},dataType.deleteValue=function(key,schemaValue){},dataType.filterValidate=function(name,value){return new JervDesignJsValueEditorFilterValidateResult}};angular.module("JervDesignJsValueEditor").factory("JervDesignJsValueEditorFilterDataType",[function(){return JervDesignJsValueEditorFilterDataType}]);var JervDesignJsValueEditorFilterValidateResult=function(){var self=this;self.message="OK",self.isValid=!0};angular.module("JervDesignJsValueEditor").factory("JervDesignJsValueEditorFilterValidateResult",function(){return JervDesignJsValueEditorFilterValidateResult}),angular.module("JervDesignJsValueEditor").service("JervDesignJsValueEditorDataTypeArray",["JervDesignJsValueEditorFilterDataType","JervDesignJsValueEditorService",function(JervDesignJsValueEditorFilterDataType,JervDesignJsValueEditorService){var dataType=new JervDesignJsValueEditorFilterDataType;return dataType.type="array",dataType.description="Handles array",dataType.canCreateValue=!0,dataType.canUpdateValue=!0,dataType.canDeleteValue=!0,dataType.rebuildOnChange=!0,dataType.buildSchemaValues=function(name,value,accessor,schemas){for(var i=0;i<value.length;i++)JervDesignJsValueEditorService.buildDataSchema(name+"."+i,value[i],accessor+"["+i+"]",schemas)},dataType.createValue=function(key,subValue,schemaValue){key=Number(key),schemaValue[key]=subValue},dataType.updateValue=function(key,subValue,schemaValue){key=Number(key),schemaValue[key]=subValue},dataType.deleteValue=function(key,schemaValue){schemaValue.splice(key,1)},dataType}]),angular.module("JervDesignJsValueEditor").service("JervDesignJsValueEditorDataTypeBoolean",["JervDesignJsValueEditorFilterDataType",function(JervDesignJsValueEditorFilterDataType){var dataType=new JervDesignJsValueEditorFilterDataType;return dataType.type="boolean",dataType.description="Handles booleans",dataType.directive="jerv-design-js-value-editor-field-boolean",dataType}]),angular.module("JervDesignJsValueEditor").service("JervDesignJsValueEditorDataTypeNull",["JervDesignJsValueEditorFilterDataType",function(JervDesignJsValueEditorFilterDataType){var dataType=new JervDesignJsValueEditorFilterDataType;return dataType.type="null",dataType.description="Handles nulls",dataType}]),angular.module("JervDesignJsValueEditor").service("JervDesignJsValueEditorDataTypeNumber",["JervDesignJsValueEditorFilterDataType",function(JervDesignJsValueEditorFilterDataType){var dataType=new JervDesignJsValueEditorFilterDataType;return dataType.type="number",dataType.description="Handles numbers",dataType.directive="jerv-design-js-value-editor-field-number",dataType}]),angular.module("JervDesignJsValueEditor").service("JervDesignJsValueEditorDataTypeObject",["JervDesignJsValueEditorFilterDataType","JervDesignJsValueEditorService",function(JervDesignJsValueEditorFilterDataType,JervDesignJsValueEditorService){var dataType=new JervDesignJsValueEditorFilterDataType;return dataType.type="object",dataType.description="Handles objects",dataType.canCreateValue=!0,dataType.canUpdateValue=!0,dataType.canDeleteValue=!0,dataType.rebuildOnChange=!0,dataType.buildSchemaValues=function(name,value,accessor,schemas){for(var prop in value)JervDesignJsValueEditorService.buildDataSchema(name+"."+prop,value[prop],accessor+"."+prop,schemas)},dataType.createValue=function(key,subValue,schemaValue){schemaValue[key]=subValue},dataType.updateValue=function(key,subValue,schemaValue){schemaValue[key]=subValue},dataType.deleteValue=function(key,schemaValue){delete schemaValue[key]},dataType}]),angular.module("JervDesignJsValueEditor").service("JervDesignJsValueEditorDataTypeString",["JervDesignJsValueEditorFilterDataType",function(JervDesignJsValueEditorFilterDataType){var dataType=new JervDesignJsValueEditorFilterDataType;return dataType.type="string",dataType.description="Handles strings and nulls",dataType.directive="jerv-design-js-value-editor-field-string",dataType}]);var JervDesignJsValueEditorService=function(JervDesignJsValueEditorEvents,JervDesignJsValueEditorDataSchema){var self=this,typeServices={};self.libPath="/bower_components/jervdesign-js-value-editor/dist/",self.schemas={},self.loadingSchema={},self.getEvents=function(){return JervDesignJsValueEditorEvents},self.setLoading=function(schemaName,loading){self.loadingSchema[schemaName]=loading,JervDesignJsValueEditorEvents.trigger("loadingSchema",{schemaName:schemaName,Loading:loading})},self.setTypeService=function(dataType){typeServices[dataType.type]&&console.warn("Duplicate type set for "+dataType.type),typeServices[dataType.type]=dataType},self.getTypeService=function(type){if(!typeServices[type])throw"Type not found:"+type;return typeServices[type]},self.getType=function(name,value){var type=self.typeOf(value);return typeServices[type]?type:(console.warn("Type "+type+" service not available"),"string")},self.typeOf=function(value){return null===value?"null":void 0===value?"null":Array.isArray(value)?"array":typeof value},self.getParentSchemaData=function(ns){var schemaName=self.getSchemaName(ns),dataParentNs=self.getParentNs(ns);return self.schemas[schemaName].schema[dataParentNs]},self.getKey=function(ns){var nsParts=ns.split("."),last=nsParts.length-1;return nsParts[last]},self.getSchemaName=function(ns){var nsParts=ns.split(".");return nsParts[0]},self.getParentNs=function(ns){var nsParts=ns.split("."),last=nsParts.length-1;return nsParts.splice(last,1),nsParts.join(".")},self.getDataParentNs=function(ns){var nsParts=ns.split("."),last=nsParts.length-1;return nsParts.splice(last,1),nsParts.splice(0,1),nsParts.length<1?"":nsParts.join(".")},self.getDataNs=function(ns){var nsParts=ns.split(".");return nsParts.splice(0,1),nsParts.join(".")},self.getDataParentAccessor=function(accessor){var last=(accessor.split("."),nsParts.length-1);return nsParts.splice(last,1),nsParts.splice(0,1),nsParts.length<1?"":nsParts.join(".")},self.getDataAccessor=function(accessor){var accessorParts=accessor.split(".");return accessorParts.splice(0,1),accessorParts.join(".")},self.createValue=function(ns,key,value){var schemaName=self.getSchemaName(ns),dataParentNs=self.getDataParentNs(ns);dataParentNs&&(dataParentNs="."+dataParentNs);var parentSchema=self.getParentSchemaData(ns),parentSchemaValue=null;eval("parentSchemaValue = self.schemas."+schemaName+".data"+dataParentNs),typeServices[parentSchema.type].createValue(key,value,parentSchemaValue),typeServices[parentSchema.type].rebuildOnChange&&self.refreshDataSchema(schemaName)},self.updateValue=function(ns,value){var schemaName=self.getSchemaName(ns),key=self.getKey(ns),dataParentNs=self.getDataParentNs(ns);dataParentNs&&(dataParentNs="."+dataParentNs);var dataNs=self.getDataNs(ns);dataNs&&(dataNs="."+dataNs);var parentSchema=self.getParentSchemaData(ns),parentSchemaValue=null;eval("parentSchemaValue = self.schemas."+schemaName+".data"+dataParentNs),typeServices[parentSchema.type].updateValue(key,value,parentSchemaValue),typeServices[parentSchema.type].rebuildOnChange&&self.refreshDataSchema(schemaName)},self.deleteValue=function(ns){var schemaName=self.getSchemaName(ns),key=self.getKey(ns),dataParentNs=self.getDataParentNs(ns);dataParentNs&&(dataParentNs="."+dataParentNs);var parentSchema=self.getParentSchemaData(ns),parentSchemaValue=null;eval("parentSchemaValue = self.schemas."+schemaName+".data"+dataParentNs),typeServices[parentSchema.type].deleteValue(key,parentSchemaValue),delete self.schemas[schemaName].schema[ns],typeServices[parentSchema.type].rebuildOnChange&&self.refreshDataSchema(schemaName)},self.getDataSchema=function(ns){return self.schemas[self.getSchemaName(ns)]},self.refreshDataSchema=function(schemaName){self.setLoading(schemaName,!0),self.schemas[schemaName].schema={},self.buildDataSchema(schemaName,self.schemas[schemaName].data,"",self.schemas[schemaName].schema),JervDesignJsValueEditorEvents.trigger("updateSchema",self.schemas[schemaName]),self.setLoading(schemaName,!1)},self.newDataSchema=function(schemaName,data){return self.setLoading(schemaName,!0),self.schemas[schemaName]={},self.schemas[schemaName].data=data,self.schemas[schemaName].schema=self.buildDataSchema(schemaName,data,"",{}),JervDesignJsValueEditorEvents.trigger("newSchema",self.schemas[schemaName]),self.setLoading(schemaName,!1),self.schemas[schemaName]},self.buildDataSchema=function(name,value,accessor,schemas){schemas||(schemas={}),accessor||(accessor=""),name||(name="");var type=self.getType(name,value),schema=new JervDesignJsValueEditorDataSchema;return schema.type=type,schema.originalType=type,schema.name=name,schema.accessor=accessor,schema.value=value,schema.originalValue=value,schema.displayValue=JSON.stringify(value),schema.originalDisplayValue=JSON.stringify(value),schema.dataType=typeServices[type],schemas[name]=schema,typeServices[type].buildSchemaValues(name,value,accessor,schemas),schemas},self.filterValidate=function(schema){var type=self.getType(name,value);return typeServices[type].filterValidate(name,value)}};angular.module("JervDesignJsValueEditor").service("JervDesignJsValueEditorService",["JervDesignJsValueEditorEvents","JervDesignJsValueEditorDataSchema",function(JervDesignJsValueEditorEvents,JervDesignJsValueEditorDataSchema){return new JervDesignJsValueEditorService(JervDesignJsValueEditorEvents,JervDesignJsValueEditorDataSchema)}]),angular.module("JervDesignJsValueEditor").filter("JervDesignJsValueEditorLimitLength",function(){return function(input,length){input=""+input;var result=input.substring(0,length);return result.length!==input.length&&(result+=" ..."),result}}),angular.module("JervDesignJsValueEditor").filter("JervDesignJsValueEditorNsFormatFilter",function(){return function(ns){ns=""+ns;var nsParts=ns.split("."),count=nsParts.length,last=count-1,spaceCnt=count-1,spaces=Array(spaceCnt).join(" -");return spaces+" "+nsParts[last]}}),angular.module("JervDesignJsValueEditor").filter("JervDesignJsValueEditorSchemaSearchFilter",function(){return function(input,length){if(!query)return input;var result={},regex=new RegExp(query,"i");return angular.forEach(input,function(site){site.domain&&regex.test(site.domainName)&&(result[site.siteId]=site)}),result}}),angular.module("JervDesignJsValueEditor").directive("jervDesignJsValueEditorStandardDisplay",["$compile","JervDesignJsValueEditorService",function($compile,JervDesignJsValueEditorService){function link($scope,element,attrs){var events=JervDesignJsValueEditorService.getEvents();$scope.rootNamespace=attrs.rootNamespace,$scope.loadingSchema=JervDesignJsValueEditorService.loadingSchema,$scope.showedit={};var loadingSchema=function(loadingData){(loadingData.schemaName=$scope.rootNamespace)&&($scope.loadingSchema=loadingData.loading)};events.on("loadingSchema","JervDesignJsValueEditor",loadingSchema),$scope.rootNamespace||($scope.rootNamespace="root"),$scope.valueData||console.error("value-data attribute missing or empty");var schemaData=JervDesignJsValueEditorService.newDataSchema($scope.rootNamespace,$scope.valueData),buildSchema=function(schemaData){$scope.schemas=schemaData.schema};buildSchema(schemaData),events.on("updateSchema","JervDesignJsValueEditor",buildSchema)}return{link:link,scope:{valueData:"="},templateUrl:JervDesignJsValueEditorService.libPath+"standard-display.html"}}]),angular.module("JervDesignJsValueEditor").directive("jervDesignJsValueEditorField",["JervDesignJsValueEditorService",function(JervDesignJsValueEditorService){function link($scope,element,attrs){$scope.typeChanged=!1,$scope.createData={key:"",displayValue:""},$scope.onRawChange=function(){$scope.typeChanged=$scope.schemadata.originalDisplayValue!==$scope.schemadata.displayValue};var onUpdate=function(){$scope.showedit=!1};$scope.cancel=function(){$scope.schemadata.displayValue=$scope.schemadata.originalDisplayValue,$scope.schemadata.value=$scope.schemadata.originalValue,$scope.schemadata.type=$scope.schemadata.originalType,onUpdate()},$scope.create=function(){try{var value=JSON.parse($scope.createData.displayValue)}catch(err){return void alert("Invalid JSON")}return $scope.createData.key?(JervDesignJsValueEditorService.createValue($scope.schemadata.name+"."+$scope.createData.key,$scope.createData.key,value),void onUpdate()):void alert("Key is required")},$scope.save=function(){try{var value=JSON.parse($scope.schemadata.displayValue)}catch(err){return void alert("Invalid JSON")}JervDesignJsValueEditorService.updateValue($scope.schemadata.name,value),onUpdate()},$scope.delete=function(){JervDesignJsValueEditorService.deleteValue($scope.schemadata.name),onUpdate()}}return{link:link,scope:{schemadata:"=",showedit:"="},templateUrl:JervDesignJsValueEditorService.libPath+"field.html"}}]);
//# sourceMappingURL=jervdesign-js-value-editor.min.js.map